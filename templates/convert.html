<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convert PBN to PDF</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/board.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/card.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
</head>
<body>
    <div class="container">


        <h2>üîÑ ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡πá‡∏ô PDF</h2>
        <button id="convertBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏õ‡∏•‡∏á</button>
        <p id="status"></p>
        <a id="print-btn" class="hidden">üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF</a>
        <div class="grid" id="board"></div>


        {% if all_card_tracking %}
        <pre id="cardTrackingData">
            {% for card, positions in all_card_tracking.items() %}{{ card }}={{ positions }}
            {% endfor %}
        </pre>
        {% endif %}
    </div>

    <script src="{{ url_for('static', filename='js/board.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
    <!-- <script>
        document.getElementById("print-btn").addEventListener("click", async function () {
            const printBtn = document.getElementById("print-btn");
            printBtn.textContent = "Downloading..."; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏∏‡πà‡∏°
            printBtn.disabled = true; // ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß

            try {
                const board = document.getElementById("board");
                const cards = Array.from(board.children);
                const cardsPerPage = 9; // 9 ‡πÉ‡∏ö‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ (3x3)

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏Ç‡∏ô‡∏≤‡∏î A4
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF("portrait", "mm", "a4");

                // ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏û‡πà (mm)
                const cardWidth = 63;
                const cardHeight = 88;
                const spacingX = 5;
                const spacingY = 5;
                const startX = 5;
                const startY = 10;

                let pageIndex = 0;

                for (let i = 0; i < cards.length; i += cardsPerPage) {
                    if (pageIndex > 0) pdf.addPage();

                    let row = 0, col = 0;

                    for (let j = 0; j < cardsPerPage && i + j < cards.length; j++) {
                        const card = cards[i + j];

                        // ‡πÅ‡∏Ñ‡∏õ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ö‡∏ô‡∏µ‡πâ
                        await html2canvas(card, { scale: 3 }).then((canvas) => {
                            const imgData = canvas.toDataURL("image/png");

                            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á X, Y ‡∏ï‡∏≤‡∏° Grid 3x3
                            let x = startX + col * (cardWidth + spacingX);
                            let y = startY + row * (cardHeight + spacingY);

                            pdf.addImage(imgData, "PNG", x, y, cardWidth, cardHeight);
                        });

                        // ‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á Grid (3x3)
                        col++;
                        if (col >= 3) {
                            col = 0;
                            row++;
                        }
                    }
                    pageIndex++;
                }

                pdf.save("cards.pdf");
                console.log("PDF ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß");
            } catch (error) {
                console.error("Error generating PDF:", error);
            }

            printBtn.textContent = "Print to PDF"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥
            printBtn.disabled = false; // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

        });
    </script> -->
</body>
</html>
